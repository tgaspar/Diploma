% -*- TeX:SI -*-
% slovene sub-mode for spell check

\documentclass[a4paper,twoside,openright,12pt]{book}
\usepackage[cp1250]{inputenc}  %Kodna stran za Windows okolje, za linux je kodna stran latin2
\usepackage[Slovene]{babel}    % pravila za slovensko deljenje besed
\usepackage[pdftex]{UNI-LJ-FE-Diploma} %Stil za diplome na Fakulteti za elektrotehniko (za pdfTeX v MkiTex)
%\usepackage[pctex]{UNI-LJ-FE-Diploma} %Stil za diplome na Fakulteti za elektrotehniko  (za pcTex)

%*************************** PRILAGODITVE *****************************
% mapa s slikami
\potgrafike{./Slike/}
%prilagoditev levega roba sodih strani. Èe se pri dvostranskem tisku robovi ne umemajo se lahko poveèa ali pomanjša
\zamaknirobsodihstrani{0mm}

%*************************** NASLOVNA STRAN *****************************
\naslov{Vodenje robota v stiku s podajnim objektom}
\avtor{Timotej Gašpar} 
\univerza{Univerza v Ljubljani}
\fakulteta{Fakulteta za elektrotehniko}
\delo{Magistrsko delo}
\date{Ljubljana, 2015}
\mentor{prof. dr. Aleš Ude}
\somentor{dr. Leon Žlajpah}
\begin{document}

%------------------------ ZAÈETNI DEL -----------------------------------
\frontmatter
%------------------------------------------------------------------------


%************************ NASLOVNA STRAN ********************************
\maketitle


%*************************** ZAHVALA ************************************
\zahvala Zahvalil se bi rad staršem za popolno podporo pri študiju, bratu, ker me je motiviral èeprav tega ni vedel ter partnerki, ker je vedela kaj je treba reè v katerem trenutku.
Zahvalil bi se tudi somentorju Leonu Žlajpahu, ker mi je z izkušnjami ogromno pomagal. 


%*************************** VSEBINA *************************************
\tableofcontents

%*************************** SEZNAM SLIK in TABEL  ***********************
\seznamslik
\seznamtabel

%***************************  SEZNAM UPORABLJENIH SIMBOLOV  **************

\seznamsimbolov

V prièujoèem zakljuènem delu so uporabljeni naslednje velièine in
simboli:

\begin{table}[h]
\centering
%\begin{footnotesize}
\begin{tabular}{l l l l}
 \hline \multicolumn{2}{c}{\bf{Velièina / oznaka}} & \multicolumn{2}{c}{\bf{Enota}}  \\
 \hline
Ime & Simbol & Ime & Simbol \\
 \hline
 èas & $t$  & sekunda & s \\
 frekvenca & $f$  & Hertz & Hz \\
 tlak & $p$  & Pascal & Pa \\
 sila vzgona & $\textbf{\textit{f}}_\text{vz}$  & Newton & N \\
 gostota & $\rho$  & - & kg/m$^3$ \\
 masa telesa  & $m_\text{t}$  & kilogram & kg \\
 vhodna napestost & $U_\text{vh}$ & volt  & V \\
 Jacobijeva matrika & $\mathbf{J}$  & - & - \\
  \hline
\end{tabular}
%\end{footnotesize}
  \caption{Velièine in simboli}
  \label{prebojne_trdnosti}
\end{table}

Pri èemer so vektorji in matrike napisani s poudarjeno pisavo.
Natanènejši pomen simbolov in njihovih indeksov je razviden iz
ustreznih slik ali pa je pojasnjen v spremljajoèem besedilu, kjer je
simbol uporabljen.


%------------------------ GLAVNI DEL ------------------------------------
\mainmatter
%-------------------------------------------------------------------------


%********************* POVZETEK V SLOVENŠÈINI ****************************
\povzetek

\kljucnebesede beseda1, beseda2, beseda3


%*************************** POVZETEK V ANGLEŠÈINI ***********************
\abstract

The thesis addresses ...

\keywords word1, word2, word3


%***************************** UVOD **************************************
\chapter{Uvod} \label{uvod}


%*********************** OSREDNJA POGLAVJA ********************************

%*********************** PA10 ********************************
\chapter{Robotski manipulator PA-10 in senzor sile JR3} \label{oprema}

\section{Robotski manipulator PA-10}
Celotno delo, ki je v tem delu je bilo narejeno na robotskem mehanizmu Portable General Purpose Intellient Arm - PA10, proizvajalca Mitsubishi Heavy Industries. Gre za serijskega robota s sedmimi sklepi. Robotska roka tehta 36 kg in ima nosilnost 10 kg. Servo motorji v sklepih se napajajo preko izmeniène napetosti. Prenosi med v sklepih so realizirani s mehanizmom harmonic drive. Proizvajalec navaja, da lahko bazo robota pritrdimo v katerokoli lego. To pomeni, da ga lahko fiksiramo bodisi na tla, na stane ali na strop. Za namene tega dela je bila baza robota fiksirana na tla.


\subsection{Denavitt - Hartemberg parametri za robotski manipulator PA-10}

Robotski mehanizem PA-10 ima 7 prostostnih stopenj razporejenih tako, da spominjajo na èloveško roko. Prvi trije sklepi so oznaèeni kot ramenskio sklepi (shoulder), S1, S2, S3. Naslednja dva sta oznaèena kot komolèni sklepi (elbow), E1, E2. Zadnja dva sklepa pa sta oznaèena kot zapestna (wrist), W1, W2. Ker ima robot veè kot 6 prostostnih stopenj ga uvršèamo med redundantne mehanizme. Vsi sklepi so rotacijski.

Proizvajalec v dokumentaciji navaja zadostno kolièino podatkov, da lahko uporabnik sam zgradi kinematièen model robota. S poznavanjem razdalj in postavitev sklepov je moè definirati Denavit-Hartenberg (kasneje D-H parametri) parametre.

\input{./Slike/arm_length.tex}

\begin{table}
\centering	

	\begin{tabular}{l | l l l l l l}

		 
		\textit{i}	& $ \alpha_{i-1} $ & $a_{i-1}$ & $d_i$ & $ \theta_i $ \\
		\hline
		1			& 0 & 0 & 0.315 & \textit{q1} \\
		2			& $-\frac{\pi}{2}$ & 0 & 0 & \textit{q2} \\
		3			& $\frac{\pi}{2}$ & 0 & 0.45 & \textit{q3} \\
		4			& $-\frac{\pi}{2}$ & 0 & 0 & \textit{q4} \\
		5			& $\frac{\pi}{2}$ & 0 & 0.5 & \textit{q5} \\
		6			& $-\frac{\pi}{2}$ & 0 & 0 & \textit{q6} \\
		7			& $\frac{\pi}{2}$ & 0 & 0.08 & \textit{q7} \\
	
	
	\end{tabular}
  \caption{D-H parametri}
  \label{dh_params} 
\end{table}

S pomoèjo D-H parametrov lahko definiramo geometrijski model robota oz. transformacijsko matriko $ A_{PA10} = A_1 \times A_2 \times ... \times A_7 $, ki nam preslika koordinate iz koordinatnega sistema baze ($ x_{base} $) v koordinatni sistem na vrhu robota($ x_{PA10} $) v odvisnosti od kotov v sklepih. 
Tako velja relacija

\begin{center}
	$x_{PA10} = A_{PA10} \times x_{base}$
\end{center}




\input{./Slike/pa10-drawing.tex}



\section{Servo Krmilnik} \label{servo}
%*********************** SERVO KRMILNIK ********************************
Proizvajalec ob robotskem mehanizmu dostavi tudi krmilnik. V krmilniku je so štiri loèeni krmilniki za servo motorje. Vsak servo krmilnik krmili dva sklepa razen enega. Krmilnik omogoèa vodenje na dva naèina. Prvi naèin predvideva, da motorje krmilimo navorno, drugi pa hitrostno. Razlika je tudi v regulatorjih. Navorno krmiljenje je realizirano z analognim P regulatorjem toka, hitrostna regulacija pa je realizirana z digitalnim PI regulatorjem s frekvenco pribliæno 1500 Hz.

Na zadnji strani krmilinka je stikalo s katerim lahko priklopimo med naèinom delovanj imenovanim "Teach Mode" ter "Run mode". Ko je krmilnik nastavljen na "Teach Mode" so hitrosti v sklepih omejene tako, da se lahko vrh robota premika s maksimalno hitrostjo 250 mm/s

Ob vžigu krmilnika se parametri za vodenje robota naložijo iz EEPROM tabele v RAM. Med temi parametri so recimo tudi ojaèanje proporcionalnega ter integracijskega dela regulatorja, limite posameznih stopenj, razmerje prenosa zobnikov, itd.

Referenène navore ali hitrosti v sklepih na servo krmilniku nastavljamo preko zunanjega vmesnika. Krmilnik ima ARCNET vmesnik, ki podpira serijsko komunikacijo po ARCNET protokolu. Krmilink ima loèen konektor za vhod (Rx) ter izhod (Tx). Uporabljena so optièna vodila.
Za komunikacijo s servo krmilnikom je bil v namen tega dela narejen vmesnik, ki je podrobneje opisan v poglavju XXX.


\subsection{Komunikacija z ARCNET vmesnikom} \label{arc_drive}

ArcNET vmesnik na  krmilniku skrbi za komunikacijo med servo krmilniki ter visokonivojskim vmesniku. Dovoli hitrost komunikacije do 5 Mb/0.s Njegova naloga je interpretirati dobljene pakete, primerno nastaviti parametre na servo krmilniku ter posredovati primeren odgovor višjenivojskemu vmesniku.
Ko višjenivojski vmesnik ne pošilja nobenih ukazov je ARCNET vmesnik v èakanju. V tem stanju èaka na primerno sestavljen paket. Vsak paket se zaène z veliko tiskano èrko zapisano v 8-bitnem ASCII formatu. Z razliènimi èrkami lahko izberemo razlièna stanja oz. naèine delovanja ARCNET vmesnika:


\begin{itemize}
	\item Izpis EEPROM tabele
	\item Vpis v EEPROM tabelo
	\item Vpis v RAM tabelo
	\item Kopiranje iz RAM v EEPROM tabelo
	\item Postavitev kotov na nièelno vrednost	
	\item Sporstitev zavor
	\item Vodenje sklepov
\end{itemize}

Tako lahko uporabnik poljubno spremeni razne parametre, ki se uporabljajo za vodenje robota. Možno je na primer spremeniti ojaèanja PI regegulatorja, vendar se teh funkcionalosti v tem delu ni podrobneje raziskalo saj ni bilo potrebe po tem.

V tem delu se je v veèini uporabljalo naèin za vodenje sklepov. Ta naèin se izbere tako, da se ARCNET vmesniku najprej pošlje ukaz, ki se zaène z velikim tiskanim S (ASCII DEC 65), nadaljuje se s pošiljanjem paketov, ki se zaènejo s veliko tiskano èrko C (ASCII DEC 67) ter zakljuèi s tem, da se pošlje paket, ki se zaène z velikim tiskanim E (ASCII 69). Pri tem naèinu delovanja je potrebno posvetiti nekaj pozornosti hitrosti pošiljanja, saj, èe paketi ne pridejo v intervalu specificiranem na krmilniku bo ARCNET vmesnik šel iz tega naèina delovanja nazaj na naèin èakanje.

Paket, ki se zaène s C in nosi podatke o krmiljenju sklepov robota je velik 35 bajtov, 5 za vsak sklep. Prvi bajt je kontrolni in samo prvi trije  biti nosijo podatke o vodenju:

\begin{enumerate}
	\item vklop ali izklop mehanske zavore (1 - vklop, 0 - izklop)
	\item vklop ali izklop servo motorja (1 - vklop, 0 - izklop)
	\item izbira navornega ali hitrostnega naèina (1 - navorni, 0 - hitrostni)
\end{enumerate}
Drugi in tretji bajt nosijo podatek o referenènem navoru na sklepu. Ta podatek bo uporabljen le, èe je servo motor nastavljen na navorni naèin delovanja. Dvo bajtni podatek pa je v formatu 0.001 Nm/digit.
Èetrti in peti bajt nosijo podatek o referenèni hitrosti na sklepu. Podatek je tako kot pri navornem delovanju v uporabi le, ko vodimo servo motor na hitrostnem naèinu. Dvo bajtni podatek je v formatu 0.0002 rad/s/digit.

\input{./Slike/control_mode.tex}


\section{Senzor sile in navorov - JR3}

Za namene tega dela se je med vrhom robota ter prijemalom pritrdilo senzor sil JR3. Senzor nam omogoèa merjenje sil in navorov v X, Y in Z smeri. Sensor je narejen iz uporovnih listièev porazdeljenih po notranjosti. Iz specifikacij senzorja je razvidno, da uporablja 8 uporovnih listièev. S tem, ko na senzor deluje zunanja sila ali navor, se upornost na uporovnih listièih spremeni.
Senzor sile JR3 ima v svoji notranjosti poleg uporovnih listièev še AD-pretvornik. Iz senzorja tako dobimo podatke o navoru v digitalnem zapisu. Senzor se navadno prikljuèi preko 6 ali 8 pinskega kabla na osebni raèunalnik, na katerem je kartica, ki skrbi za digitalno obdelavo signala. Kartice na osebnem raèunalniku so v ISA ali PCI izvedbi. Za potrebe tega dela se je uporabljala kartica na ISA vodilu. Na kartici je vezje za digitalno procesiranje signalov. V dokumentaciji kartice so opisani trije nizkoprepustni filtri z razliènimi mejnimi frekvencami. V tem delu se je uporabilo filter z mejno frekvenco 500 Hz.


%*********************** ARCNET SERVER ********************************
\chapter{UDP strežnik za komunikacijo s krmilnikom robota ter senzorjem JR3} \label{arcnet}
V prejšnjem poglavju so bile opisane mehanske (robotski mehanizem PA-10 in krmilik mehanizma) in senzorne (senzor sile JR3) komponente, ki se jih je za to delo uporabljalo. Vendar pa ni nobena od uporabljenih mehanskih ali senzornih komponent imela delujoèega programskega dela. Za potrebe izvedbe tega dela je tako bila narejena primerna programska oprema, da je omogoèala uporabo mehanske ter senzorne opreme. Nastal strežnik za komunikacijo s krmilnikom robota po ARCNET mreži. Sledil je program za prebiranje vrednosti izmerjenih sil ter navorov iz senzorja JR3.

V naslednjih poglavjih se bo podrobneje opisalo delovanje obeh programov ter konèni izdelek, ki predstavlja UDP strežnik. Vsa programska oprema, ki bo opisana je bila zgrajena v programskem jeziku C ter na operacijskem sistemu CentOS Linux z jedrom Kernel 2.6. Razlog za tem je, da je dokumentacija \cite{arc_howto}, ki je bila najdena na internetu in opisuje oporabo ARCNET kartic, opisovala postopke za Kernel 2.6.


\section{ARCNET strežnik}

V poglavju \ref{arc_drive} je opisan ARCNET vmesnik na krmilniku robota. Opisana so stanja vmesnika in kakšne so zahteve za preklapljanje med njimi. V tem poglavju bo opisano vse potrebno za vspostaviti komunikacijo z krmilnikom robota po ARCNET protokolu. 

Uporabnik, ki bi želel uporabljati PCI kartico na raèunalniku za komunikacijo po ARCNET omrežju mora najprej zagotoviti ustrezne gonilnike. Tej so na razpolago v \cite{arc_howto}. Gonilnik se doda v Linux okolju kot modul. Po uspešnem zagonu gonilnika lahko uporabnik vspostavi ARCNET mrežo s standardno Linux komando \verb|ifconfig| in sicer na sledeè naèin:
\begin{verbatim}
ifconfig arc0 192.168.1.1
\end{verbatim}
Od tukaj dalje lahko uporabnik razvija programsko opremo. V primeru tega dela so avtorji uporabljali programski jezik C. Avtorji tega dela so od tega koraka dalje zaèeli razvijati strežnik za posredovanje ukazov pridobljenih iz UDP omrežja na ARCNET omrežje. UDP omrežje se je uprablilo zato, ker lahko dosegamo visoke hitrosti prenosa podatkov, hkrati pa omogoèa možnost hitrega ukrepanja v primeru izguba paketov.
Avtorji tega dela so razvili strežnik, ki deluje s frekvenco 500 Hz. To se zagotavlja z onemogoèanjem uporabe namizja ter uporabo Linux C funkcije \verb| clock_gettime(clockid_t clk_id, struct timespec *tp);|. Funcija vrne vrednost sistemskega èasa. S veèkratnim klicom te funkcije lahko vidimo kolko sistemskega èasa je minilo od enega do drugega klica. S tem lahko zagotovimo, da program deluje s neko konstantno frekvenco.

\section{JR3 strežnik}

Senzor sil in navorov JR3 ima se lahko povezuje z osebnim raèunalnikom preko kartice, ki se prikljuèi na vodilo ISA (starejši standard) ter kartice, ki se prikljuèi na vodilo PCI (novejši standard). Na uporabljenem raèunalniku za potrebe tega dela je namešèena kartica na vodilu ISA. Ker je standard starejši je podjetje prenehalo s podporo tega standarda. Kot posledica tega so avtorji tega dela razvili svojo programsko opremo za komunikacijo z notranjimi registri kartice. Osnovne informacije o podatkih do katerih lahko dostopamo po registrih se nahajajo v dokumentaciji \cite{jr3_doc}, ki jo priloži proizvajalec.
Dokumentacija navaja, da v kolikor želi uporabnik odèitati vrednost sile ali navora Fx mora tako prebrati osnovno vrednost $F_s$ na registru imenovanem (\verb|full scale|), jo pomnožiti z vrednostjo $F_f$, ki je na registru izbranega filtra (\verb|corrent force|). Na zadnje more to vrednost delit s konstanto $K_p$, da pretvori v prave enote (N ali Nm).

\begin{equation}\label{force_filt}
F_x = \frac{F_s \cdot F_f}{K_p}
\end{equation}

Ker senzor meri silo in navor v treh smereh je potrebno opraviti izraèun za vsako dimenzijo posebej. 


\section{Združitev ARCNET in JR3 strežnika}



\section{Razlogi za strežnik}




%*********************** ADMITANÈNO VODENJE ********************************
\chapter{Admitanèno krmiljenje} \label{admitance}
\section{Teorija}
\section{Implementacija}
\section{Rezultati}

%*********************** INVERZNA KINEMATIKA ********************************
\chapter{Krmiljenje z inverzno dinamiko} \label{invdyn}
\section{Teorija}
\section{Implementacija}
\section{Rezultati}


%*********************** REZULTATI ********************************
\chapter{Rezultati} \label{rezultati}

%*********************** SIMULINK KNJIŽNICE ********************************
\chapter{Simulink knjižice} \label{simulink}

Ob nastajanju tega dela so bile razvite razne simulink knjižnice za krmiljnenje robota PA10. Namen teh je omogoèiti uporabo robotskega mehanizma PA10 osebam, ki niso seznanjene z vsemi podrobnosti.
%*********************** ZAKLJUÈEK ********************************
\chapter{Zakljuèek} \label{zakljucek}


%**************** LITERATURA ************************
\bibliographystyle{ieeetrslo}
\bibliography{literatura}

%**************** PRILOGE ************************


\appendix
\chapter{Appendix 1} \label{dodatekA}
\chapter{Appendix 2} \label{dodatekB}
\chapter{Appendix 3} \label{dodatekC}



Postopek dela:
\begin{description}
\item
\end{description}

\chapter{Predloge za navajanje literature - baza BibTex}
\label{dodatekE}

\footnotesize
\begin{verbatim}
@ARTICLE{clanek1,
   author = "L[eslie] A. Aamport",
   title = "The Gnats and Gnus Document Preparation System",
   journal = "\mbox{G-Animal's} Journal",
   year = 1986,
   volume = 41,
   number = 7,
   pages = "73-77",
   month = jul,
}


@BOOK{knjiga1,
   author = "Donald E. Knuth",
   title = "Seminumerical Algorithms",
   publisher = "Addison-Wesley",
   address = "Reading, Massachusetts",
   year = "1981",
}


@INPROCEEDINGS{vzborniku,
   author = "Alfred V. Oaho and Jeffrey D. Ullman and Mihalis Yannakakis",
   title = "On Notions of Information Transfer in {VLSI} Circuits",
   editor = "Wizard V. Oz and Mihalis Yannakakis",
   booktitle = "Proc. Fifteenth Annual ACM" # STOC,
   pages = "133--139",
   month = mar,
   year = 1983,
   address = "Boston",
   publisher = "Academic Press",
}


@misc{spletna_stran,
  author = "LLC",
  title = "{MS Windows NT Kernel Description [Online]}",
  howpublished = "Dosegljivo: \url{http://web.archive.org}",
  note = "[Dostopano: 19. 4. 2013]"
}
\end{verbatim}
\normalsize



\end{document}
